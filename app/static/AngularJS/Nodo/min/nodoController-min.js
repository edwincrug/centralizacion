registrationModule.controller("nodoController",function(e,o,n,a,i,t,r,l){e.isLoading=!1,e.idProceso=1,e.perfil=1;var s=function(e,n,i,t){$("#btnEnviar").button("reset"),o.tipoFolio=0,a.error("Ocurrio un problema")};e.init=function(){c(),l.get(o.currentEmployee).success(u).error(s)},o.CargaEmpleado=function(n){c(),e.id=n,l.get(o.currentEmployee).success(u).error(s)};var c=function(){if(""!=getParameterByName("employee")&&(o.currentEmployee=getParameterByName("employee")),null==o.currentEmployee){var e=prompt("Ingrese un número de empleado",1);o.currentEmployee=e}},u=function(n,t,r,l){o.empleado=n,null!=o.empleado?(e.folio=""!=getParameterByName("id")?getParameterByName("id"):e.id,e.folio?i.getHeader(e.folio,o.empleado.idUsuario).success(d).error(s):$("#slide").click()):a.error("El empleado no existe en el sistema.")};e.navegaFolio=function(n){$("#navegaLinks").modal("hide"),1==o.navegacionBusqueda&&1==o.tipoFolio?(e.navBusFolio=1,i.getNavegacion(n,2,3).success(y).error(s),o.navegacionBusqueda=0):o.CargaEmpleado(n)};var d=function(n,t,r,l){e.iniciaNodos=0,e.expediente=n,1==e.navBusFolio&&(e.expediente.nodoActual=e.nodNavBusqueda),e.navBusFolio=0,null!=e.expediente?i.getAll(e.folio,e.idProceso,o.empleado.idPerfil).success(g).error(s):a.error("No existe información para este expediente.")};e.VerOrdenPadre=function(e){location.href="/?id="+e.folioPadre+"&employee=1"},e.VerOrdenHijo=function(e){location.href="/?id="+e.folioHijo+"&employee=1"};var g=function(o,n,a,i){e.listaNodos=o,e.numElements=o.length,p(),setTimeout(function(){$("ul#standard").roundabout({btnNext:".next",btnNextCallback:function(){alert(".next trigger")},btnPrev:".prev",btnPrevCallback:function(){alert(".prev trigger"),f(".prev")},clickToFocusCallback:function(){alert(".next trigger"),f(".next")}}),m(e.currentPage)},1)},p=function(){e.currentPage=e.navDestino>0?e.navDestino:e.expediente.nodoActual,e.navDestino=0},f=function(o){1==e.expediente.esPlanta?v(e.currentPage,$("ul#standard").roundabout("getChildInFocus")+1):(e.currentPage=$("ul#standard").roundabout("getChildInFocus")+1,0!=e.listaNodos[e.currentPage-1].enabled?m(e.currentPage):(a.warning("El nodo "+e.currentPage+" no está disponible para su perfil."),$(o).click()))};e.setPage=function(o){0!=o.enabled?1==e.expediente.esPlanta?v(e.currentPage,o.id):(e.currentPage=o.id,m(e.currentPage)):a.warning("Nodo "+e.currentPage+" no disponible para su perfil.")};var v=function(o,n){var a=global_settings.nodoSaltoRefacciones[0],t=global_settings.nodoSaltoRefacciones[1],r=0,l=0;e.especial=!1,a>o&&n>t&&(r=1,l=2,e.especial=!0),o>t&&a>n&&(r=3,l=2,e.especial=!0),a>o&&n>=a&&t>=n&&(r=1,l=2),o>=a&&t>=o&&n>t&&(r=2,l=3),o>t&&n>=a&&t>=n&&(r=3,l=2),o>=a&&t>=o&&a>n&&(r=2,l=1),e.navDestino=e.especial?0:n,0!=r&&0!=l?i.getNavegacion(e.folio,r,l).success(y).error(s):(e.currentPage=n,m(e.currentPage))};o.navBusqueda=function(n,a,t){var r=n,l=1==n?2:3;o.navegacionBusqueda=1,e.navBusFolio=1,e.folio=t,e.nodNavBusqueda=0,o.tipoFolio=n,1==n&&a>=global_settings.nodoSaltoRefacciones[0]&&(r=1,l=2,e.nodNavBusqueda=global_settings.nodoSaltoRefacciones[0]-1),2==n&&a>global_settings.nodoSaltoRefacciones[1]&&(e.nodNavBusqueda=global_settings.nodoSaltoRefacciones[1],r=2,l=3),i.getNavegacion(t,r,l).success(y).error(s)};var m=function(o){$("ul#standard").roundabout("animateToChild",o-1),e.currentNode=e.listaNodos[o-1],N(),B(),e.iniciaNodos=1},N=function(){angular.forEach(e.listaNodos,function(o,n){n==e.currentPage-1?o.active=1:o.active=0}),x()},P=function(o,n,a,i){e.isLoading=!1,e.listaAlertas=o,x()},b=function(o,n,a,i){e.listaDocumentos=o,r.getByNodo(e.idProceso,e.currentNode.id,e.currentNode.folio).success(P).error(s)},B=function(){1!=e.currentNode.estatus?(e.isLoading=!0,x(),t.getByNodo(e.currentNode.id,e.currentNode.folio,e.perfil).success(b).error(s)):a.warning("El nodo "+e.currentNode.id+" aún no se activa para el expediente actual. No existen documentos para mostrar.")},x=function(){"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()},y=function(n,i,t,r){alert(o.tipoFolio),1==e.navBusFolio?n.length>0?(1==o.tipoFolio?(o.linksNavegacion=n,$("#navegaLinks").modal("show")):(o.linksNavegacion=n,o.tituloNavegacion="Facturas",setTimeout(function(){$("#navegaLinks").modal("show")},300)),e.navBusFolio=0):o.CargaEmpleado(e.folio):n.length>0?(o.linksNavegacion=n,$("#navegaLinks").modal("show")):0==o.navegacionBusqueda?a.warning("No existen remisiones/facturas para continuar el flujo."):(o.CargaEmpleado(e.folio),o.navegacionBusqueda=0),o.tipoFolio=0}});